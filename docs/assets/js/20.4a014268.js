(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{706:function(t,a,s){"use strict";s.r(a);var e=s(62),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"dc3-mqtt-驱动模块"}},[t._v("DC3 Mqtt 驱动模块 "),a("a",{staticClass:"header-anchor",attrs:{href:"#dc3-mqtt-驱动模块"}},[t._v("#")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("位置")]),t._v("：iot-dc3\\dc3-driver\\dc3-driver-mqtt")]),t._v(" "),a("p",[a("strong",[t._v("依赖服务")]),t._v("（参考 Idea 开发环境启动即可）：dc3-mysql、dc3-mongo、dc3-redis、dc3-rabbitmq、dc3-center-register、dc3-center-manager、dc3-center-data、dc3-center-auth、dc3-center-gateway、iot-dc3-web")]),t._v(" "),a("p",[a("strong",[t._v("开源工具")]),t._v("：Spring Cloud")]),t._v(" "),a("p",[a("strong",[t._v("Mqtt")]),t._v("：基于客户端-服务器的消息发布/订阅传输协议。MQTT 协议是轻量、简单、开放和易于实现的，这些特点使它适用范围非常广泛。在很多情况下，包括受限的环境中，如：机器与机器（M2M）通信和物联网（IoT）。其在，通过卫星链路通信传感器、偶尔拨号的医疗设备、智能家居、及一些小型化设备中已广泛使用。")])]),t._v(" "),a("h3",{attrs:{id:"配置文件"}},[t._v("配置文件 "),a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[t._v("#")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("位置")]),t._v("：iot-dc3\\dc3-driver\\dc3-driver-mqtt\\src\\main\\resources\\application.yml")])]),t._v(" "),a("h4",{attrs:{id:"_1-mqtt-服务器连接配置"}},[t._v("1. mqtt 服务器连接配置 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_1-mqtt-服务器连接配置"}},[t._v("#")])]),t._v(" "),a("blockquote",[a("p",[a("em",[t._v("mqtt 用于配置连接一个 Mqtt 服务所需要的基本参数")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mqtt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用户名")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dc3\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 密码")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dc3\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Mqtt 服务URL")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//dc3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rabbitmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1883")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("receive-topics")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("qos")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default-send-topic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("qos")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" command\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("completion-timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("batch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("speed")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n")])])]),a("h4",{attrs:{id:"_2-driver-point-attribute"}},[t._v("2. driver.point-attribute "),a("a",{staticClass:"header-anchor",attrs:{href:"#_2-driver-point-attribute"}},[t._v("#")])]),t._v(" "),a("blockquote",[a("p",[a("em",[t._v("point-attribute 用于配置读取一个 Mqtt 点位值所需要的基本参数")])]),t._v(" "),a("p",[a("strong",[t._v("读取一个 Mqtt 服务的点位值需要：指令 Topic、指令 Qos，那么 "),a("code",[t._v("dc3-mqtt")]),t._v(" 驱动模块此处的 "),a("code",[t._v("point-attribute")]),t._v(" 就应该如下:")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("point-attribute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("displayName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 指令Topic\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" commandTopic\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" commandTopic\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 测点/设备接收下行指令的Mqtt主题\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("displayName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 指令Qos\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" commandQos\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" int\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 测点/设备接收下行指令的Mqtt主题的Qos\n")])])]),a("h4",{attrs:{id:"_3-driver-schedule"}},[t._v("3. driver.schedule "),a("a",{staticClass:"header-anchor",attrs:{href:"#_3-driver-schedule"}},[t._v("#")])]),t._v(" "),a("blockquote",[a("p",[a("em",[t._v("schedule 用于设置 读 和 自定义方法的调度")])]),t._v(" "),a("p",[a("strong",[t._v("read")]),t._v("：用于配置周期性调用 iot-dc3\\dc3-driver\\dc3-driver-mqtt\\src\\main\\java\\com\\dc3\\driver\\service\\impl\\DriverCustomServiceImpl.java （read 方法）")]),t._v(" "),a("p",[a("strong",[t._v("custom")]),t._v("：用于配置周期性调用 iot-dc3\\dc3-driver\\dc3-driver-mqtt\\src\\main\\java\\com\\dc3\\driver\\service\\impl\\DriverCustomServiceImpl.java（schedule 方法）")]),t._v(" "),a("p",[a("strong",[t._v("enable")]),t._v("：是否启动")]),t._v(" "),a("p",[a("strong",[t._v("corn")]),t._v("：corn 表达式，用于设置调度规则")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schedule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("read")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("corn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0/30 * * * * ?'")]),t._v("\n")])])]),a("h3",{attrs:{id:"小试牛刀"}},[t._v("小试牛刀 "),a("a",{staticClass:"header-anchor",attrs:{href:"#小试牛刀"}},[t._v("#")])]),t._v(" "),a("h4",{attrs:{id:"_1-启动依赖服务"}},[t._v("1. 启动依赖服务 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_1-启动依赖服务"}},[t._v("#")])]),t._v(" "),a("ul",[a("li",[t._v("参考 Idea 开发环境启动 dc3-mysql、dc3-mongo、dc3-redis、dc3-rabbitmq、dc3-center-register、dc3-center-manager、dc3-center-data、dc3-center-auth、iot-dc3-web")]),t._v(" "),a("li",[t._v("启动 dc3-driver-mqtt")])]),t._v(" "),a("h4",{attrs:{id:"_2-启动-mqtt-调试工具"}},[t._v("2. 启动 Mqtt 调试工具 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动-mqtt-调试工具"}},[t._v("#")])]),t._v(" "),a("p",[t._v("安装并启动 Mqtt.fx 软件")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/docs/code/2-start.html"}},[t._v("MQTTX版本")])],1),t._v(" "),a("p",[t._v("下载链接："),a("a",{attrs:{href:"https://pan.baidu.com/s/1zcdKpBiYLOdwanqxn-GZWA",target:"_blank",rel:"noopener noreferrer"}},[t._v("百度云盘 Mqtt.fx"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("验证码："),a("code",[t._v("wona")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/dc3/driver/mqtt/mqtt-2.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"_3-驱动"}},[t._v("3. 驱动 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_3-驱动"}},[t._v("#")])]),t._v(" "),a("p",[t._v("切换到 ''"),a("strong",[t._v("驱动")]),t._v('" 菜单，当前 '),a("code",[t._v("Mqtt")]),t._v(" 启动启动成功，并处于 "),a("strong",[t._v("在线")]),t._v(" 状态")]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/operation/code/02e367ee-19ea-4e03-846e-e7675a3dbf1e.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"_4-模板"}},[t._v("4. 模板 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_4-模板"}},[t._v("#")])]),t._v(" "),a("p",[t._v("切换到 “"),a("strong",[t._v("模板")]),t._v("” 菜单，新建一个"),a("code",[t._v("Mqtt数据模板")]),t._v(" ，如下")]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/operation/code/410ae5ee-4311-4ef6-9678-e22614ee8010.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"_5-位号"}},[t._v("5. 位号 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_5-位号"}},[t._v("#")])]),t._v(" "),a("p",[t._v("点击编辑,下一步,切换到 “"),a("strong",[t._v("模板位号配置")]),t._v("” 菜单，为刚刚新建的 "),a("code",[t._v("模板")]),t._v(" 配置待读取的 位号，这里以一个 "),a("code",[t._v("Float")]),t._v(" 类型的为例，如下")]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/operation/code/e0f86efa-bb51-4a0e-a5d0-4411dccf46ce.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"_6-设备"}},[t._v("6. 设备 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_6-设备"}},[t._v("#")])]),t._v(" "),a("p",[t._v("切换到 “"),a("strong",[t._v("设备")]),t._v("” 菜单，新建一个设备,绑定"),a("code",[t._v("模板")]),t._v(",绑定"),a("code",[t._v("驱动")]),t._v("如下")]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/operation/code/4b5e5a22-e2ce-479f-a312-b5c9c77d8849.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"_7-位号配置"}},[t._v("7. 位号配置 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_7-位号配置"}},[t._v("#")])]),t._v(" "),a("blockquote",[a("p",[t._v("提示：如果不需要控制设备，该位号配置可以不用配置")])]),t._v(" "),a("p",[t._v("点击编辑,下一步切换到 “"),a("strong",[t._v("位号配置")]),t._v("” 菜单，为新建的 "),a("code",[t._v("设备")]),t._v(" ，配置 "),a("code",[t._v("位号")]),t._v(" 的的 "),a("strong",[t._v("属性值")]),t._v("，从而是 "),a("code",[t._v("dc3-mqtt")]),t._v(" 模块能下发控制指令到 "),a("code",[t._v("Mqtt.fx")]),t._v(" 软件，如下")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("指令 Topic")]),t._v("：用于向设备发送控制指令的 topic，例如： "),a("code",[t._v("dc3/mqtt/commad/device_1")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("指令 Qos")]),t._v("：用于向设备发送控制指令的 topic 的 qos，例如：0")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/operation/code/42f09d4e-59b9-44a7-b77a-518bdf6c48dd.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"_8-mqtt-fx-设置"}},[t._v("8. Mqtt.fx 设置 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_8-mqtt-fx-设置"}},[t._v("#")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/dc3/driver/mqtt/mqtt-15.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"/assets/images/dc3/driver/mqtt/mqtt-16.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"/assets/images/dc3/driver/mqtt/mqtt-17.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"/assets/images/dc3/driver/mqtt/mqtt-18.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"_9-数据"}},[t._v("9. 数据 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_9-数据"}},[t._v("#")])]),t._v(" "),a("p",[t._v("切换到 “数据” 菜单，在 "),a("code",[t._v("Mqtt.fx")]),t._v(" 中 publish 就会采集到一条数据")]),t._v(" "),a("p",[a("strong",[t._v("发送数据：")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("Public Topic")]),t._v(" 填写 "),a("code",[t._v("dc3/default/dc3-driver-mqtt/data")])]),t._v(" "),a("p",[t._v("请务必替换设备 ID 和位号 ID，点击设备标题和位号标题能获取到对应的ID。")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"deviceId"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1647845409185337346"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pointId"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1647845983742070785"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"createTime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2022-03-17 14:39:36.000"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"/assets/images/dc3/driver/mqtt/mqtt-19.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"/assets/images/operation/code/f350523c-d4cf-4626-94ea-bfc96dd4d3e0.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"_13-下发控制指令到设备"}},[t._v("13. 下发控制指令到设备 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_13-下发控制指令到设备"}},[t._v("#")])]),t._v(" "),a("p",[a("code",[t._v("Mqtt.fx")]),t._v(" 配置如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/dc3/driver/mqtt/mqtt-21.png",alt:""}})]),t._v(" "),a("p",[t._v("使用 接口调用指令下发，向设备端写入数据")]),t._v(" "),a("p",[t._v("请注意，设备 ID（deviceId）和位号 ID（pointId），如实际数据库中的数据为准，以下为例子：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/dc3/driver/mqtt/mqtt-22.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"/assets/images/dc3/driver/mqtt/mqtt-23.png",alt:""}})]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("Mqtt.fx")]),t._v(" 中收到发送过来的控制指令，如图：\n"),a("img",{attrs:{src:"/assets/images/dc3/driver/mqtt/mqtt-24.png",alt:""}})])])}),[],!1,null,null,null);a.default=r.exports}}]);